<% controller.action_name == "new" ? action = "create" : action = "update" %>
<% controller.action_name == "new" ? method = :post : method = :put %>
<% controller.action_name == "new" ? title = @new_title : title = @contract.title %>

<%= form_for @contract, :url => { :action => action }, :method => method do |f| %>
  <%= f.hidden_field :project_id, :value => @project.id %>
  <div class="box tabular">
    <p>
      <%= f.label :title %>
      <%= f.text_field :title, :value => title, :size => 50 %>
    </p>
    <p>
      <%= f.label :description %>
      <%= f.text_area :description, { :cols => 50, :rows => 3 } %>
    </p>
    <p>
      <%= f.label l(:field_agreement_date) %>
      <%= f.date_select :agreement_date %>
    </p>
    <p>
      <%= f.label l(:field_start_date) %>
      <%= f.date_select :start_date %>
    </p>
    <p>
      <%= f.label l(:field_end_date) %>
      <%= f.date_select :end_date %>
    </p>
    <p>
      <%= f.label l(:field_purchase_amount) %>
      <%= l('number.currency.format.unit') if l('number.currency.format.format').index('%u') == 0 %> <%= f.text_field :purchase_amount, :size => 10 %> <%= l('number.currency.format.unit') if l('number.currency.format.format').index('%u') != 0 %>
    </p>
    <p>
      <%= f.label l(:field_hourly_rate) %>
      <%= l('number.currency.format.unit') if l('number.currency.format.format').index('%u') == 0 %> <%= f.text_field :hourly_rate, :size => 10 %> <%= l('number.currency.format.unit') if l('number.currency.format.format').index('%u') != 0 %>
    </p>
    <p>
      <%= f.label l(:field_contract_url) %>
      <%= f.text_field :contract_url, :size => 50 %>
    </p>
    <p>
      <%= f.label l(:field_invoice_url) %>
      <%= f.text_field :invoice_url, :size => 50 %>
    </p>
  </div>
  <% if !@contractors.nil? && !@contractors.empty? %>
    <fieldset id="contractor_rates" class="box tabular"><legend>Contractor Rates</legend>
      <% @contractors.each do |contractor| %>
        <% rate = @contractor_rates[contractor.id] %>
        <p>
          <label><%= contractor.name %></label>
          &nbsp;&nbsp;&nbsp;$<%= text_field_tag "rates[#{contractor.id}]", format("%#.2f", rate), :size => 5 %>
        </p>
      <% end %>
    </fieldset>
  <% end %>
  <div>
    <% controller.action_name == "new" ? msg = l(:label_create_contract) : msg = l(:label_update_contract) %>
    <p><%= f.submit msg  %></p>
  </div>
<% end %>
